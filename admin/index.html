<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¸”ë¡œê·¸ ê´€ë¦¬ì | jehongsem</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Noto Sans KR', sans-serif; background: #f5f7fa; color: #333; }
        
        /* ë¡œê·¸ì¸ í™”ë©´ */
        .login-screen { min-height: 100vh; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .login-box { background: white; padding: 48px; border-radius: 16px; box-shadow: 0 20px 60px rgba(0,0,0,0.2); width: 100%; max-width: 420px; }
        .login-box h1 { font-size: 24px; margin-bottom: 8px; text-align: center; }
        .login-box p { color: #666; margin-bottom: 32px; font-size: 14px; text-align: center; line-height: 1.6; }
        .login-box input { width: 100%; padding: 14px 16px; border: 2px solid #e0e0e0; border-radius: 8px; margin-bottom: 16px; font-size: 14px; }
        .login-box input:focus { outline: none; border-color: #667eea; }
        .login-box button { width: 100%; padding: 14px; background: #667eea; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 15px; }
        .login-box button:hover { background: #5a6fd6; }
        
        /* ì•± ë ˆì´ì•„ì›ƒ */
        .app { display: none; min-height: 100vh; }
        .app.active { display: flex; }
        
        /* ì‚¬ì´ë“œë°” */
        .sidebar { width: 260px; background: #1a1f36; color: white; padding: 24px 0; position: fixed; height: 100vh; overflow-y: auto; }
        .sidebar-header { padding: 0 24px 24px; border-bottom: 1px solid rgba(255,255,255,0.1); margin-bottom: 24px; }
        .sidebar-header h1 { font-size: 18px; margin-bottom: 4px; }
        .sidebar-header p { font-size: 12px; opacity: 0.7; }
        .nav-section { padding: 0 16px; margin-bottom: 24px; }
        .nav-item { display: flex; align-items: center; gap: 12px; padding: 12px 16px; border-radius: 8px; cursor: pointer; font-size: 14px; opacity: 0.7; transition: all 0.2s; }
        .nav-item:hover { background: rgba(255,255,255,0.1); opacity: 1; }
        .nav-item.active { background: #667eea; opacity: 1; }
        .logout-btn { margin: 24px; padding: 10px; background: rgba(255,255,255,0.1); color: white; border: none; border-radius: 6px; cursor: pointer; width: calc(100% - 48px); font-size: 14px; }
        .logout-btn:hover { background: rgba(255,255,255,0.2); }
        
        /* ë©”ì¸ ì½˜í…ì¸  */
        .main-content { flex: 1; margin-left: 260px; padding: 32px; }
        .page-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
        .page-header h2 { font-size: 24px; }
        
        /* í…Œì´ë¸” */
        .posts-table { background: white; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); overflow: hidden; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 16px 20px; text-align: left; border-bottom: 1px solid #eee; }
        th { background: #f8f9fa; font-size: 13px; color: #666; font-weight: 600; }
        .category { display: inline-block; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 500; }
        .category-IT { background: #dbeafe; color: #1d4ed8; }
        .category-AI { background: #ede9fe; color: #7c3aed; }
        .category-êµìœ¡ { background: #d1fae5; color: #059669; }
        .category-ê²½ì˜ { background: #e0e7ff; color: #4338ca; }
        .btn-edit { padding: 6px 12px; background: #f3f4f6; border: none; border-radius: 4px; cursor: pointer; margin-right: 8px; }
        .btn-edit:hover { background: #e5e7eb; }
        .btn-delete { padding: 6px 12px; background: #fef2f2; color: #dc2626; border: none; border-radius: 4px; cursor: pointer; }
        .btn-delete:hover { background: #fee2e2; }
        
        /* ì—ë””í„° */
        .editor-container { background: white; border-radius: 12px; padding: 32px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
        .form-group { margin-bottom: 24px; }
        .form-group label { display: block; font-weight: 600; margin-bottom: 8px; font-size: 14px; }
        .form-group input, .form-group textarea, .form-group select { 
            width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; font-family: inherit;
        }
        .form-group input:focus, .form-group textarea:focus, .form-group select:focus { outline: none; border-color: #667eea; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .btn-save { padding: 12px 24px; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 14px; }
        .btn-save:hover { background: #5a6fd6; }
        .btn-cancel { padding: 12px 24px; background: #f3f4f6; color: #333; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 14px; margin-left: 12px; }
        .btn-cancel:hover { background: #e5e7eb; }
        
        /* í† ìŠ¤íŠ¸ */
        .toast { position: fixed; bottom: 32px; right: 32px; padding: 16px 24px; border-radius: 8px; color: white; display: none; z-index: 1000; font-size: 14px; }
        .toast.success { background: #10b981; }
        .toast.error { background: #ef4444; }
        
        /* ë¡œë”© */
        .loading { padding: 60px; text-align: center; color: #666; }
        
        /* ë¹ˆ ìƒíƒœ */
        .empty-state { padding: 60px; text-align: center; color: #999; }
        
        /* í˜ì´ì§€ ìˆ¨ê¹€ */
        .page { display: none; }
        .page.active { display: block; }
        
        /* ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            .sidebar { width: 100%; position: relative; height: auto; }
            .main-content { margin-left: 0; }
            .form-row { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <!-- ë¡œê·¸ì¸ í™”ë©´ -->
    <div class="login-screen" id="loginScreen">
        <div class="login-box">
            <h1>ğŸ” ë¸”ë¡œê·¸ ê´€ë¦¬ì</h1>
            <p>GitHub Personal Access Tokenì„ ì…ë ¥í•˜ì—¬<br><b>jehongsem/personal_blog</b> ê´€ë¦¬ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤.</p>
            <input type="password" id="tokenInput" placeholder="ghp_xxxxxxxxxxxx">
            <button onclick="login()">ë¡œê·¸ì¸</button>
        </div>
    </div>

    <!-- ì•± -->
    <div class="app" id="app">
        <aside class="sidebar">
            <div class="sidebar-header">
                <h1>ğŸ“ ë¸”ë¡œê·¸ ê´€ë¦¬ì</h1>
                <p>jehongsem/personal_blog</p>
            </div>
            <div class="nav-section">
                <div class="nav-item active" data-page="posts" onclick="showPage('posts')">ğŸ“„ í¬ìŠ¤íŠ¸ ê´€ë¦¬</div>
                <div class="nav-item" data-page="new" onclick="showPage('new')">âœï¸ ìƒˆ í¬ìŠ¤íŠ¸</div>
                <div class="nav-item" data-page="settings" onclick="showPage('settings')">âš™ï¸ ì‚¬ì´íŠ¸ ì„¤ì •</div>
            </div>
            <button class="logout-btn" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
        </aside>

        <main class="main-content">
            <!-- í¬ìŠ¤íŠ¸ ëª©ë¡ í˜ì´ì§€ -->
            <div id="page-posts" class="page active">
                <div class="page-header">
                    <h2>í¬ìŠ¤íŠ¸ ëª©ë¡</h2>
                    <button class="btn-save" onclick="showPage('new')">+ ìƒˆ í¬ìŠ¤íŠ¸</button>
                </div>
                <div class="posts-table">
                    <table>
                        <thead>
                            <tr>
                                <th>ì œëª©</th>
                                <th>ì¹´í…Œê³ ë¦¬</th>
                                <th>ë‚ ì§œ</th>
                                <th>ì‘ì—…</th>
                            </tr>
                        </thead>
                        <tbody id="postsTableBody">
                            <tr><td colspan="4" class="loading">ë¡œë”© ì¤‘...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- ìƒˆ í¬ìŠ¤íŠ¸ / í¸ì§‘ í˜ì´ì§€ -->
            <div id="page-editor" class="page">
                <div class="page-header">
                    <h2 id="editorTitle">ìƒˆ í¬ìŠ¤íŠ¸ ì‘ì„±</h2>
                </div>
                <div class="editor-container">
                    <form id="postForm" onsubmit="savePost(event)">
                        <input type="hidden" id="editMode" value="new">
                        <input type="hidden" id="originalFilename" value="">
                        <input type="hidden" id="originalSha" value="">
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>íŒŒì¼ ID (ì˜ë¬¸/ìˆ«ì/í•˜ì´í”ˆ)</label>
                                <input type="text" id="postId" placeholder="my-first-post" required>
                            </div>
                            <div class="form-group">
                                <label>ì¹´í…Œê³ ë¦¬</label>
                                <select id="postCategory" required>
                                    <option value="IT">IT</option>
                                    <option value="AI">AI</option>
                                    <option value="êµìœ¡">êµìœ¡</option>
                                    <option value="ê²½ì˜">ê²½ì˜</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>ì œëª©</label>
                            <input type="text" id="postTitle" placeholder="í¬ìŠ¤íŠ¸ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”" required>
                        </div>
                        
                        <div class="form-group">
                            <label>ìš”ì•½</label>
                            <input type="text" id="postExcerpt" placeholder="í¬ìŠ¤íŠ¸ ìš”ì•½ (ëª©ë¡ì— í‘œì‹œë¨)">
                        </div>
                        
                        <div class="form-group">
                            <label>ë³¸ë¬¸ (HTML ì§€ì›)</label>
                            <textarea id="postContent" rows="15" placeholder="<h2>ì†Œì œëª©</h2><p>ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”...</p>"></textarea>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>ëŒ€í‘œ ì´ë¯¸ì§€</label>
                                <input type="text" id="postImage" placeholder="images/banner.png" value="images/banner.png">
                            </div>
                            <div class="form-group">
                                <label>ë‚ ì§œ</label>
                                <input type="date" id="postDate" required>
                            </div>
                        </div>
                        
                        <div>
                            <button type="submit" class="btn-save">ì €ì¥í•˜ê¸°</button>
                            <button type="button" class="btn-cancel" onclick="showPage('posts')">ì·¨ì†Œ</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- ì‚¬ì´íŠ¸ ì„¤ì • í˜ì´ì§€ -->
            <div id="page-settings" class="page">
                <div class="page-header">
                    <h2>ì‚¬ì´íŠ¸ ì„¤ì •</h2>
                </div>
                <div class="editor-container">
                    <form id="settingsForm" onsubmit="saveSettings(event)">
                        <input type="hidden" id="contentSha" value="">
                        
                        <div class="form-group">
                            <label>ì‚¬ì´íŠ¸ ì œëª©</label>
                            <input type="text" id="siteTitle" placeholder="ì¬í™ìƒ˜ ë¸”ë¡œê·¸">
                        </div>
                        
                        <div class="form-group">
                            <label>íˆì–´ë¡œ ì œëª©</label>
                            <input type="text" id="heroTitle" placeholder="ì¬í™ìƒ˜ ë¸”ë¡œê·¸">
                        </div>
                        
                        <div class="form-group">
                            <label>íˆì–´ë¡œ ë¶€ì œëª©</label>
                            <input type="text" id="heroSubtitle" placeholder="IT Â· AI Â· êµìœ¡ ì´ì•¼ê¸°">
                        </div>
                        
                        <button type="submit" class="btn-save">ì„¤ì • ì €ì¥</button>
                    </form>
                </div>
            </div>
        </main>
    </div>

    <!-- í† ìŠ¤íŠ¸ ë©”ì‹œì§€ -->
    <div id="toast" class="toast"></div>

    <script>
        // ========== ì„¤ì • ==========
        const REPO = 'jehongsem/personal_blog';
        const BRANCH = 'main';
        
        let token = '';
        let posts = [];
        let indexData = [];
        let contentData = null;

        // ========== ì´ˆê¸°í™” ==========
        document.addEventListener('DOMContentLoaded', () => {
            const savedToken = localStorage.getItem('github_token');
            if (savedToken) {
                token = savedToken;
                initApp();
            }
            
            // ì˜¤ëŠ˜ ë‚ ì§œ ê¸°ë³¸ê°’
            document.getElementById('postDate').valueAsDate = new Date();
        });

        // ========== ì¸ì¦ ==========
        async function login() {
            const inputToken = document.getElementById('tokenInput').value.trim();
            if (!inputToken) {
                showToast('í† í°ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }
            
            try {
                const res = await fetch(`https://api.github.com/repos/${REPO}`, {
                    headers: { 'Authorization': `token ${inputToken}` }
                });
                
                if (res.ok) {
                    token = inputToken;
                    localStorage.setItem('github_token', token);
                    initApp();
                } else if (res.status === 401) {
                    showToast('í† í°ì´ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.', 'error');
                } else if (res.status === 404) {
                    showToast('ì €ì¥ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
                } else {
                    showToast('ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                }
            } catch (e) {
                showToast('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        function logout() {
            localStorage.removeItem('github_token');
            location.reload();
        }

        function initApp() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('app').classList.add('active');
            loadPosts();
        }

        // ========== í˜ì´ì§€ ì „í™˜ ==========
        function showPage(page) {
            // ëª¨ë“  í˜ì´ì§€ ìˆ¨ê¸°ê¸°
            document.querySelectorAll('.page').forEach(el => el.classList.remove('active'));
            
            // ë„¤ë¹„ê²Œì´ì…˜ í™œì„±í™” ìƒíƒœ ì—…ë°ì´íŠ¸
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            
            if (page === 'posts') {
                document.getElementById('page-posts').classList.add('active');
                document.querySelector('[data-page="posts"]').classList.add('active');
                loadPosts();
            } else if (page === 'new') {
                resetPostForm();
                document.getElementById('page-editor').classList.add('active');
                document.querySelector('[data-page="new"]').classList.add('active');
                document.getElementById('editorTitle').textContent = 'ìƒˆ í¬ìŠ¤íŠ¸ ì‘ì„±';
                document.getElementById('editMode').value = 'new';
            } else if (page === 'edit') {
                document.getElementById('page-editor').classList.add('active');
                document.getElementById('editorTitle').textContent = 'í¬ìŠ¤íŠ¸ í¸ì§‘';
                document.getElementById('editMode').value = 'edit';
            } else if (page === 'settings') {
                document.getElementById('page-settings').classList.add('active');
                document.querySelector('[data-page="settings"]').classList.add('active');
                loadSettings();
            }
        }

        // ========== GitHub API ==========
        async function githubAPI(endpoint, options = {}) {
            const res = await fetch(`https://api.github.com/repos/${REPO}${endpoint}`, {
                ...options,
                headers: {
                    'Authorization': `token ${token}`,
                    'Accept': 'application/vnd.github.v3+json',
                    'Content-Type': 'application/json',
                    ...options.headers
                }
            });
            return res;
        }

        async function getFile(path) {
            try {
                const res = await githubAPI(`/contents/${path}?ref=${BRANCH}`);
                if (res.ok) {
                    const data = await res.json();
                    const content = JSON.parse(decodeURIComponent(escape(atob(data.content))));
                    return { content, sha: data.sha };
                }
            } catch (e) {
                console.error('getFile error:', e);
            }
            return null;
        }

        async function saveFile(path, content, sha = null, message = 'Update via Admin') {
            const body = {
                message,
                content: btoa(unescape(encodeURIComponent(JSON.stringify(content, null, 2)))),
                branch: BRANCH
            };
            if (sha) body.sha = sha;
            
            const res = await githubAPI(`/contents/${path}`, {
                method: 'PUT',
                body: JSON.stringify(body)
            });
            return res.ok;
        }

        async function deleteFile(path, sha, message = 'Delete via Admin') {
            const res = await githubAPI(`/contents/${path}`, {
                method: 'DELETE',
                body: JSON.stringify({ message, sha, branch: BRANCH })
            });
            return res.ok;
        }

        // ========== í¬ìŠ¤íŠ¸ ê´€ë¦¬ ==========
        async function loadPosts() {
            const tbody = document.getElementById('postsTableBody');
            tbody.innerHTML = '<tr><td colspan="4" class="loading">ë¡œë”© ì¤‘...</td></tr>';
            
            try {
                // index.json ë¡œë“œ
                const indexFile = await getFile('posts/index.json');
                if (indexFile && Array.isArray(indexFile.content)) {
                    indexData = indexFile.content;
                } else {
                    indexData = [];
                }
                
                // posts í´ë” íŒŒì¼ ëª©ë¡
                const res = await githubAPI(`/contents/posts?ref=${BRANCH}`);
                if (!res.ok) throw new Error('Failed to load posts');
                
                const files = await res.json();
                posts = [];
                
                for (const file of files) {
                    if (file.name.endsWith('.json') && file.name !== 'index.json') {
                        const postFile = await getFile(`posts/${file.name}`);
                        if (postFile) {
                            posts.push({
                                filename: file.name,
                                sha: postFile.sha,
                                ...postFile.content
                            });
                        }
                    }
                }
                
                // ë‚ ì§œìˆœ ì •ë ¬
                posts.sort((a, b) => new Date(b.date) - new Date(a.date));
                renderPosts();
                
            } catch (e) {
                console.error('loadPosts error:', e);
                tbody.innerHTML = '<tr><td colspan="4" class="empty-state">í¬ìŠ¤íŠ¸ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</td></tr>';
            }
        }

        function renderPosts() {
            const tbody = document.getElementById('postsTableBody');
            
            if (posts.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" class="empty-state">í¬ìŠ¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤. ìƒˆ í¬ìŠ¤íŠ¸ë¥¼ ì‘ì„±í•´ë³´ì„¸ìš”!</td></tr>';
                return;
            }
            
            tbody.innerHTML = posts.map(post => `
                <tr>
                    <td><b>${escapeHtml(post.title)}</b></td>
                    <td><span class="category category-${post.category}">${post.category}</span></td>
                    <td>${post.date}</td>
                    <td>
                        <button class="btn-edit" onclick="editPost('${post.filename}')">í¸ì§‘</button>
                        <button class="btn-delete" onclick="deletePost('${post.filename}', '${post.sha}')">ì‚­ì œ</button>
                    </td>
                </tr>
            `).join('');
        }

        function resetPostForm() {
            document.getElementById('postForm').reset();
            document.getElementById('editMode').value = 'new';
            document.getElementById('originalFilename').value = '';
            document.getElementById('originalSha').value = '';
            document.getElementById('postImage').value = 'images/banner.png';
            document.getElementById('postDate').valueAsDate = new Date();
        }

        function editPost(filename) {
            const post = posts.find(p => p.filename === filename);
            if (!post) return;
            
            document.getElementById('editMode').value = 'edit';
            document.getElementById('originalFilename').value = filename;
            document.getElementById('originalSha').value = post.sha;
            document.getElementById('postId').value = post.id || filename.replace('.json', '');
            document.getElementById('postTitle').value = post.title || '';
            document.getElementById('postExcerpt').value = post.excerpt || '';
            document.getElementById('postContent').value = post.content || '';
            document.getElementById('postCategory').value = post.category || 'IT';
            document.getElementById('postImage').value = post.image || 'images/banner.png';
            document.getElementById('postDate').value = post.date || '';
            
            showPage('edit');
        }

        async function savePost(e) {
            e.preventDefault();
            
            const editMode = document.getElementById('editMode').value;
            const originalFilename = document.getElementById('originalFilename').value;
            const originalSha = document.getElementById('originalSha').value;
            
            const postId = document.getElementById('postId').value.trim();
            const filename = `${postId}.json`;
            
            const postData = {
                id: postId,
                title: document.getElementById('postTitle').value.trim(),
                excerpt: document.getElementById('postExcerpt').value.trim(),
                content: document.getElementById('postContent').value,
                category: document.getElementById('postCategory').value,
                image: document.getElementById('postImage').value.trim() || 'images/banner.png',
                date: document.getElementById('postDate').value
            };
            
            try {
                let sha = null;
                
                // í•­ìƒ ìµœì‹  index.json ë¶ˆëŸ¬ì˜¤ê¸°
                const indexFile = await getFile('posts/index.json');
                let currentIndexData = [];
                if (indexFile && Array.isArray(indexFile.content)) {
                    currentIndexData = [...indexFile.content];
                }
                
                // í¸ì§‘ ëª¨ë“œì—ì„œ íŒŒì¼ëª…ì´ ë³€ê²½ëœ ê²½ìš°
                if (editMode === 'edit' && originalFilename && originalFilename !== filename) {
                    // ê¸°ì¡´ íŒŒì¼ ì‚­ì œ
                    await deleteFile(`posts/${originalFilename}`, originalSha, `Rename ${originalFilename} to ${filename}`);
                    
                    // index.jsonì—ì„œ ê¸°ì¡´ íŒŒì¼ëª… ì œê±°
                    currentIndexData = currentIndexData.filter(f => f !== originalFilename);
                } else if (editMode === 'edit' && originalSha) {
                    sha = originalSha;
                }
                
                // íŒŒì¼ ì €ì¥
                const success = await saveFile(`posts/${filename}`, postData, sha, 
                    editMode === 'new' ? `Create ${filename}` : `Update ${filename}`);
                
                if (success) {
                    // index.json ì—…ë°ì´íŠ¸ (ìƒˆ íŒŒì¼ì´ë©´ ë§¨ ì•ì— ì¶”ê°€)
                    if (!currentIndexData.includes(filename)) {
                        currentIndexData.unshift(filename);
                    }
                    
                    // ìµœì‹  SHAë¡œ ë‹¤ì‹œ ë¶ˆëŸ¬ì™€ì„œ ì €ì¥
                    const latestIndexFile = await getFile('posts/index.json');
                    const indexSuccess = await saveFile('posts/index.json', currentIndexData, latestIndexFile?.sha, 'Update index.json');
                    
                    if (indexSuccess) {
                        showToast('ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                    } else {
                        showToast('í¬ìŠ¤íŠ¸ëŠ” ì €ì¥ëì§€ë§Œ index.json ì—…ë°ì´íŠ¸ ì‹¤íŒ¨. ìˆ˜ë™ìœ¼ë¡œ ì¶”ê°€í•´ì£¼ì„¸ìš”.', 'error');
                    }
                    showPage('posts');
                } else {
                    showToast('ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                }
            } catch (e) {
                console.error('savePost error:', e);
                showToast('ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        async function deletePost(filename, sha) {
            if (!confirm(`"${filename}" í¬ìŠ¤íŠ¸ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
            
            try {
                const success = await deleteFile(`posts/${filename}`, sha, `Delete ${filename}`);
                
                if (success) {
                    // í•­ìƒ ìµœì‹  index.json ë¶ˆëŸ¬ì˜¤ê¸°
                    const indexFile = await getFile('posts/index.json');
                    let currentIndexData = [];
                    if (indexFile && Array.isArray(indexFile.content)) {
                        currentIndexData = indexFile.content.filter(f => f !== filename);
                    }
                    
                    await saveFile('posts/index.json', currentIndexData, indexFile?.sha, 'Update index.json');
                    
                    showToast('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                    loadPosts();
                } else {
                    showToast('ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                }
            } catch (e) {
                console.error('deletePost error:', e);
                showToast('ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // ========== ì‚¬ì´íŠ¸ ì„¤ì • ==========
        async function loadSettings() {
            try {
                const file = await getFile('content.json');
                if (file) {
                    contentData = file.content;
                    document.getElementById('contentSha').value = file.sha;
                    document.getElementById('siteTitle').value = file.content.site?.title || '';
                    document.getElementById('heroTitle').value = file.content.hero?.title || '';
                    document.getElementById('heroSubtitle').value = file.content.hero?.subtitle || '';
                }
            } catch (e) {
                console.error('loadSettings error:', e);
            }
        }

        async function saveSettings(e) {
            e.preventDefault();
            
            const sha = document.getElementById('contentSha').value;
            
            // ê¸°ì¡´ ë°ì´í„° ìœ ì§€í•˜ë©´ì„œ ì—…ë°ì´íŠ¸
            const newData = {
                ...contentData,
                site: {
                    ...contentData?.site,
                    title: document.getElementById('siteTitle').value.trim(),
                    description: contentData?.site?.description || 'IT, AI, êµìœ¡ì— ê´€í•œ ì´ì•¼ê¸°'
                },
                hero: {
                    ...contentData?.hero,
                    title: document.getElementById('heroTitle').value.trim(),
                    subtitle: document.getElementById('heroSubtitle').value.trim()
                }
            };
            
            try {
                const success = await saveFile('content.json', newData, sha, 'Update site settings');
                if (success) {
                    contentData = newData;
                    // SHA ì—…ë°ì´íŠ¸ë¥¼ ìœ„í•´ ë‹¤ì‹œ ë¡œë“œ
                    const file = await getFile('content.json');
                    if (file) document.getElementById('contentSha').value = file.sha;
                    
                    showToast('ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                } else {
                    showToast('ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                }
            } catch (e) {
                console.error('saveSettings error:', e);
                showToast('ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // ========== ìœ í‹¸ë¦¬í‹° ==========
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast ${type}`;
            toast.style.display = 'block';
            setTimeout(() => { toast.style.display = 'none'; }, 3000);
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>
</body>
</html>
